# -*- coding: utf-8 -*-
"""Untitled5.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1FlSTRALoeH51WCcY46962h6s0w9saIwO
"""



plt.figure(figsize=(15, 8))
sns.barplot(x=country_variance.index, y='Actual vs Plan Variance', data=country_variance, palette='coolwarm')
plt.title('Actual vs Plan Variance by Country')
plt.xlabel('Country')
plt.ylabel('Actual vs Plan Variance')
plt.xticks(rotation=90, ha='right')
plt.ticklabel_format(style='plain', axis='y')
plt.tight_layout()
plt.show()

"""# Task
Load the Excel file "IT Expenditure dataset.xlsx" into a pandas DataFrame and display its initial structure (first few rows, column names, and data types).

## Load Excel Data

### Subtask:
Load the data from the 'IT Expenditure dataset.xlsx' file into a pandas DataFrame.

**Reasoning**:
First, I'll import the pandas library to enable data manipulation. Then, I'll load the Excel file into a pandas DataFrame using `pd.read_excel()` and display the first few rows to confirm it loaded correctly.
"""

import pandas as pd

# Load the Excel file into a pandas DataFrame
df = pd.read_excel('/content/IT Expenditure dataset.xlsx')

# Display the first few rows of the DataFrame
df.head()

"""**Reasoning**:
To display the DataFrame's column names and their respective data types, I will use the `info()` method. This will fulfill the remaining part of the subtask regarding the initial structure of the DataFrame.


"""

df.info()

"""## Final Task

### Subtask:
The Excel file has been loaded and its initial structure displayed.

## Summary:

### Data Analysis Key Findings

*   The Excel file "IT Expenditure dataset.xlsx" was successfully loaded into a pandas DataFrame named `df`, containing 81,610 entries and 12 columns.
*   The DataFrame includes columns such as 'Date', 'Business Area', 'Region', 'Country', 'IT Sub Area', 'IT Area', 'Cost element name', 'Cost Element Group', 'Cost Element Sub Group', 'Actual', 'Forecast', and 'Plan'.
*   Data types consist of 9 `object` (string) columns and 3 `float64` columns, which are 'Actual', 'Forecast', and 'Plan'.
*   The 'Actual', 'Forecast', and 'Plan' columns contain a substantial number of missing values (NaN).

### Insights or Next Steps

*   Address the missing values in the 'Actual', 'Forecast', and 'Plan' columns to ensure data integrity for subsequent analysis.
*   Further investigate the unique values and distributions of categorical columns like 'Business Area', 'Region', 'Country', 'IT Sub Area', 'IT Area', 'Cost element name', 'Cost Element Group', and 'Cost Element Sub Group' to understand the dataset's scope.

# Task
Prepare the DataFrame for variance analysis by converting the 'Date' column to datetime objects, extracting the month, filling NaN values in 'Actual', 'Forecast', and 'Plan' columns with 0, and then calculating 'Actual vs Plan Variance' and 'Actual vs Forecast Variance'.

## Prepare Data for Analysis

### Subtask:
Convert the 'Date' column to datetime objects and extract the month. Fill NaN values in 'Actual', 'Forecast', and 'Plan' columns with 0 to prepare for variance calculations.

**Reasoning**:
I will convert the 'Date' column to datetime objects, extract the month, and then fill NaN values in the 'Actual', 'Forecast', and 'Plan' columns with 0 as instructed.
"""

df['Date'] = pd.to_datetime(df['Date'], format='%b')
df['Month'] = df['Date'].dt.month

# Fill NaN values in 'Actual', 'Forecast', and 'Plan' columns with 0
df[['Actual', 'Forecast', 'Plan']] = df[['Actual', 'Forecast', 'Plan']].fillna(0)

# Display the first few rows and info to verify changes
print(df.head())
print(df.info())

"""## Calculate Variance Metrics

### Subtask:
Create new columns to calculate 'Actual vs Plan Variance' and 'Actual vs Forecast Variance'.

**Reasoning**:
I will create two new columns, 'Actual vs Plan Variance' and 'Actual vs Forecast Variance', by performing element-wise subtraction between the 'Actual' column and the 'Plan' and 'Forecast' columns, respectively.
"""

df['Actual vs Plan Variance'] = df['Actual'] - df['Plan']
df['Actual vs Forecast Variance'] = df['Actual'] - df['Forecast']

# Display the first few rows with the new variance columns
print(df.head())

"""## Analyze Variances by Dimensions

### Subtask:
Group the data by 'Month', 'Business Area', 'Country', 'Cost element name', and 'IT Area' respectively. For each grouping, calculate the sum of 'Actual', 'Plan', 'Forecast', and both variance metrics. Identify the top 5 highest and lowest variances for each dimension.

**Reasoning**:
I will start by grouping the DataFrame by 'Month' and calculating the sum of the specified financial columns, along with both variance metrics. Then, I will identify the top 5 highest and lowest variances for 'Actual vs Plan Variance' and 'Actual vs Forecast Variance' for each month.
"""

financial_cols = ['Actual', 'Plan', 'Forecast', 'Actual vs Plan Variance', 'Actual vs Forecast Variance']

# Group by Month
monthly_variance = df.groupby('Month')[financial_cols].sum()

print("\n--- Monthly Variance Analysis ---")
print("Monthly Variance:\n", monthly_variance.head())

# Top 5 highest and lowest 'Actual vs Plan Variance' by Month
top5_month_plan_high = monthly_variance.nlargest(5, 'Actual vs Plan Variance')
top5_month_plan_low = monthly_variance.nsmallest(5, 'Actual vs Plan Variance')
print("\nTop 5 Months with Highest Actual vs Plan Variance:\n", top5_month_plan_high)
print("\nTop 5 Months with Lowest Actual vs Plan Variance:\n", top5_month_plan_low)

# Top 5 highest and lowest 'Actual vs Forecast Variance' by Month
top5_month_forecast_high = monthly_variance.nlargest(5, 'Actual vs Forecast Variance')
top5_month_forecast_low = monthly_variance.nsmallest(5, 'Actual vs Forecast Variance')
print("\nTop 5 Months with Highest Actual vs Forecast Variance:\n", top5_month_forecast_high)
print("\nTop 5 Months with Lowest Actual vs Forecast Variance:\n", top5_month_forecast_low)

"""**Reasoning**:
I will continue the variance analysis by grouping the DataFrame by 'Business Area' and calculating the sum of the specified financial columns, along with both variance metrics. Then, I will identify the top 5 highest and lowest variances for 'Actual vs Plan Variance' and 'Actual vs Forecast Variance' for each business area.


"""

financial_cols = ['Actual', 'Plan', 'Forecast', 'Actual vs Plan Variance', 'Actual vs Forecast Variance']

# Group by Business Area
business_area_variance = df.groupby('Business Area')[financial_cols].sum()

print("\n--- Business Area Variance Analysis ---")
print("Business Area Variance:\n", business_area_variance.head())

# Top 5 highest and lowest 'Actual vs Plan Variance' by Business Area
top5_business_plan_high = business_area_variance.nlargest(5, 'Actual vs Plan Variance')
top5_business_plan_low = business_area_variance.nsmallest(5, 'Actual vs Plan Variance')
print("\nTop 5 Business Areas with Highest Actual vs Plan Variance:\n", top5_business_plan_high)
print("\nTop 5 Business Areas with Lowest Actual vs Plan Variance:\n", top5_business_plan_low)

# Top 5 highest and lowest 'Actual vs Forecast Variance' by Business Area
top5_business_forecast_high = business_area_variance.nlargest(5, 'Actual vs Forecast Variance')
top5_business_forecast_low = business_area_variance.nsmallest(5, 'Actual vs Forecast Variance')
print("\nTop 5 Business Areas with Highest Actual vs Forecast Variance:\n", top5_business_forecast_high)
print("\nTop 5 Business Areas with Lowest Actual vs Forecast Variance:\n", top5_business_forecast_low)

"""**Reasoning**:
I will continue the variance analysis by grouping the DataFrame by 'Country' and calculating the sum of the specified financial columns, along with both variance metrics. Then, I will identify the top 5 highest and lowest variances for 'Actual vs Plan Variance' and 'Actual vs Forecast Variance' for each country.


"""

financial_cols = ['Actual', 'Plan', 'Forecast', 'Actual vs Plan Variance', 'Actual vs Forecast Variance']

# Group by Country
country_variance = df.groupby('Country')[financial_cols].sum()

print("\n--- Country Variance Analysis ---")
print("Country Variance:\n", country_variance.head())

# Top 5 highest and lowest 'Actual vs Plan Variance' by Country
top5_country_plan_high = country_variance.nlargest(5, 'Actual vs Plan Variance')
top5_country_plan_low = country_variance.nsmallest(5, 'Actual vs Plan Variance')
print("\nTop 5 Countries with Highest Actual vs Plan Variance:\n", top5_country_plan_high)
print("\nTop 5 Countries with Lowest Actual vs Plan Variance:\n", top5_country_plan_low)

# Top 5 highest and lowest 'Actual vs Forecast Variance' by Country
top5_country_forecast_high = country_variance.nlargest(5, 'Actual vs Forecast Variance')
top5_country_forecast_low = country_variance.nsmallest(5, 'Actual vs Forecast Variance')
print("\nTop 5 Countries with Highest Actual vs Forecast Variance:\n", top5_country_forecast_high)
print("\nTop 5 Countries with Lowest Actual vs Forecast Variance:\n", top5_country_forecast_low)

"""**Reasoning**:
I will continue the variance analysis by grouping the DataFrame by 'Cost element name' and calculating the sum of the specified financial columns, along with both variance metrics. Then, I will identify the top 5 highest and lowest variances for 'Actual vs Plan Variance' and 'Actual vs Forecast Variance' for each cost element name.


"""

financial_cols = ['Actual', 'Plan', 'Forecast', 'Actual vs Plan Variance', 'Actual vs Forecast Variance']

# Group by Cost element name
cost_element_variance = df.groupby('Cost element name')[financial_cols].sum()

print("\n--- Cost Element Name Variance Analysis ---")
print("Cost Element Name Variance:\n", cost_element_variance.head())

# Top 5 highest and lowest 'Actual vs Plan Variance' by Cost element name
top5_cost_plan_high = cost_element_variance.nlargest(5, 'Actual vs Plan Variance')
top5_cost_plan_low = cost_element_variance.nsmallest(5, 'Actual vs Plan Variance')
print("\nTop 5 Cost Elements with Highest Actual vs Plan Variance:\n", top5_cost_plan_high)
print("\nTop 5 Cost Elements with Lowest Actual vs Plan Variance:\n", top5_cost_plan_low)

# Top 5 highest and lowest 'Actual vs Forecast Variance' by Cost element name
top5_cost_forecast_high = cost_element_variance.nlargest(5, 'Actual vs Forecast Variance')
top5_cost_forecast_low = cost_element_variance.nsmallest(5, 'Actual vs Forecast Variance')
print("\nTop 5 Cost Elements with Highest Actual vs Forecast Variance:\n", top5_cost_forecast_high)
print("\nTop 5 Cost Elements with Lowest Actual vs Forecast Variance:\n", top5_cost_forecast_low)

"""**Reasoning**:
I will continue the variance analysis by grouping the DataFrame by 'IT Area' and calculating the sum of the specified financial columns, along with both variance metrics. Then, I will identify the top 5 highest and lowest variances for 'Actual vs Plan Variance' and 'Actual vs Forecast Variance' for each IT area. This completes the grouping and sorting steps for all required dimensions.


"""

financial_cols = ['Actual', 'Plan', 'Forecast', 'Actual vs Plan Variance', 'Actual vs Forecast Variance']

# Group by IT Area
it_area_variance = df.groupby('IT Area')[financial_cols].sum()

print("\n--- IT Area Variance Analysis ---")
print("IT Area Variance:\n", it_area_variance.head())

# Top 5 highest and lowest 'Actual vs Plan Variance' by IT Area
top5_it_plan_high = it_area_variance.nlargest(5, 'Actual vs Plan Variance')
top5_it_plan_low = it_area_variance.nsmallest(5, 'Actual vs Plan Variance')
print("\nTop 5 IT Areas with Highest Actual vs Plan Variance:\n", top5_it_plan_high)
print("\nTop 5 IT Areas with Lowest Actual vs Plan Variance:\n", top5_it_plan_low)

# Top 5 highest and lowest 'Actual vs Forecast Variance' by IT Area
top5_it_forecast_high = it_area_variance.nlargest(5, 'Actual vs Forecast Variance')
top5_it_forecast_low = it_area_variance.nsmallest(5, 'Actual vs Forecast Variance')
print("\nTop 5 IT Areas with Highest Actual vs Forecast Variance:\n", top5_it_forecast_high)
print("\nTop 5 IT Areas with Lowest Actual vs Forecast Variance:\n", top5_it_forecast_low)

"""## Visualize Key Variance Trends

### Subtask:
Generate bar charts to visualize the 'Actual vs Plan Variance' and 'Actual vs Forecast Variance' for the top/bottom performing entities across 'Month', 'Business Area', 'Country', 'Cost element name', and 'IT Area'. Ensure plots have clear labels and legends.

**Reasoning**:
I will import the necessary libraries, `matplotlib.pyplot` and `seaborn`, to enable plotting the variance trends.
"""

import matplotlib.pyplot as plt
import seaborn as sns

print("Libraries matplotlib.pyplot and seaborn imported successfully.")

"""**Reasoning**:
I will generate bar charts for 'Month' variance analysis, specifically for 'Actual vs Plan Variance' (top 5 highest and lowest) and 'Actual vs Forecast Variance' (top 5 highest and lowest).


"""

print("--- Monthly Variance Plots ---")

# Plotting Actual vs Plan Variance for Month
fig, axes = plt.subplots(1, 2, figsize=(16, 6))
sns.barplot(x=top5_month_plan_high.index, y='Actual vs Plan Variance', data=top5_month_plan_high, ax=axes[0], palette='viridis')
axes[0].set_title('Top 5 Months: Actual vs Plan Variance')
axes[0].set_xlabel('Month')
axes[0].set_ylabel('Actual vs Plan Variance')
axes[0].ticklabel_format(style='plain', axis='y')

sns.barplot(x=top5_month_plan_low.index, y='Actual vs Plan Variance', data=top5_month_plan_low, ax=axes[1], palette='plasma')
axes[1].set_title('Bottom 5 Months: Actual vs Plan Variance')
axes[1].set_xlabel('Month')
axes[1].set_ylabel('Actual vs Plan Variance')
axes[1].ticklabel_format(style='plain', axis='y')
plt.tight_layout()
plt.show()

# Plotting Actual vs Forecast Variance for Month
fig, axes = plt.subplots(1, 2, figsize=(16, 6))
sns.barplot(x=top5_month_forecast_high.index, y='Actual vs Forecast Variance', data=top5_month_forecast_high, ax=axes[0], palette='viridis')
axes[0].set_title('Top 5 Months: Actual vs Forecast Variance')
axes[0].set_xlabel('Month')
axes[0].set_ylabel('Actual vs Forecast Variance')
axes[0].ticklabel_format(style='plain', axis='y')

sns.barplot(x=top5_month_forecast_low.index, y='Actual vs Forecast Variance', data=top5_month_forecast_low, ax=axes[1], palette='plasma')
axes[1].set_title('Bottom 5 Months: Actual vs Forecast Variance')
axes[1].set_xlabel('Month')
axes[1].set_ylabel('Actual vs Forecast Variance')
axes[1].ticklabel_format(style='plain', axis='y')
plt.tight_layout()
plt.show()

"""**Reasoning**:
The previous code generated `FutureWarning` messages due to `palette` usage without `hue` in `sns.barplot`. I will fix this by explicitly setting `hue` to the x-axis variable and adding `legend=False`. Additionally, I will extend the plotting code to generate visualizations for 'Business Area', 'Country', 'Cost element name', and 'IT Area', ensuring long labels are rotated for readability, as specified in the instructions.


"""

print("--- Monthly Variance Plots ---")

# Plotting Actual vs Plan Variance for Month
fig, axes = plt.subplots(1, 2, figsize=(16, 6))
sns.barplot(x=top5_month_plan_high.index, y='Actual vs Plan Variance', data=top5_month_plan_high, ax=axes[0], palette='viridis', hue=top5_month_plan_high.index, legend=False)
axes[0].set_title('Top 5 Months: Actual vs Plan Variance')
axes[0].set_xlabel('Month')
axes[0].set_ylabel('Actual vs Plan Variance')
axes[0].ticklabel_format(style='plain', axis='y')

sns.barplot(x=top5_month_plan_low.index, y='Actual vs Plan Variance', data=top5_month_plan_low, ax=axes[1], palette='plasma', hue=top5_month_plan_low.index, legend=False)
axes[1].set_title('Bottom 5 Months: Actual vs Plan Variance')
axes[1].set_xlabel('Month')
axes[1].set_ylabel('Actual vs Plan Variance')
axes[1].ticklabel_format(style='plain', axis='y')
plt.tight_layout()
plt.show()

# Plotting Actual vs Forecast Variance for Month
fig, axes = plt.subplots(1, 2, figsize=(16, 6))
sns.barplot(x=top5_month_forecast_high.index, y='Actual vs Forecast Variance', data=top5_month_forecast_high, ax=axes[0], palette='viridis', hue=top5_month_forecast_high.index, legend=False)
axes[0].set_title('Top 5 Months: Actual vs Forecast Variance')
axes[0].set_xlabel('Month')
axes[0].set_ylabel('Actual vs Forecast Variance')
axes[0].ticklabel_format(style='plain', axis='y')

sns.barplot(x=top5_month_forecast_low.index, y='Actual vs Forecast Variance', data=top5_month_forecast_low, ax=axes[1], palette='plasma', hue=top5_month_forecast_low.index, legend=False)
axes[1].set_title('Bottom 5 Months: Actual vs Forecast Variance')
axes[1].set_xlabel('Month')
axes[1].set_ylabel('Actual vs Forecast Variance')
axes[1].ticklabel_format(style='plain', axis='y')
plt.tight_layout()
plt.show()

print("\n--- Business Area Variance Plots ---")

# Plotting Actual vs Plan Variance for Business Area
fig, axes = plt.subplots(1, 2, figsize=(18, 7))
sns.barplot(x=top5_business_plan_high.index, y='Actual vs Plan Variance', data=top5_business_plan_high, ax=axes[0], palette='viridis', hue=top5_business_plan_high.index, legend=False)
axes[0].set_title('Top 5 Business Areas: Actual vs Plan Variance')
axes[0].set_xlabel('Business Area')
axes[0].set_ylabel('Actual vs Plan Variance')
axes[0].ticklabel_format(style='plain', axis='y')
plt.setp(axes[0].get_xticklabels(), rotation=45, ha='right')

sns.barplot(x=top5_business_plan_low.index, y='Actual vs Plan Variance', data=top5_business_plan_low, ax=axes[1], palette='plasma', hue=top5_business_plan_low.index, legend=False)
axes[1].set_title('Bottom 5 Business Areas: Actual vs Plan Variance')
axes[1].set_xlabel('Business Area')
axes[1].set_ylabel('Actual vs Plan Variance')
axes[1].ticklabel_format(style='plain', axis='y')
plt.setp(axes[1].get_xticklabels(), rotation=45, ha='right')
plt.tight_layout()
plt.show()

# Plotting Actual vs Forecast Variance for Business Area
fig, axes = plt.subplots(1, 2, figsize=(18, 7))
sns.barplot(x=top5_business_forecast_high.index, y='Actual vs Forecast Variance', data=top5_business_forecast_high, ax=axes[0], palette='viridis', hue=top5_business_forecast_high.index, legend=False)
axes[0].set_title('Top 5 Business Areas: Actual vs Forecast Variance')
axes[0].set_xlabel('Business Area')
axes[0].set_ylabel('Actual vs Forecast Variance')
axes[0].ticklabel_format(style='plain', axis='y')
plt.setp(axes[0].get_xticklabels(), rotation=45, ha='right')

sns.barplot(x=top5_business_forecast_low.index, y='Actual vs Forecast Variance', data=top5_business_forecast_low, ax=axes[1], palette='plasma', hue=top5_business_forecast_low.index, legend=False)
axes[1].set_title('Bottom 5 Business Areas: Actual vs Forecast Variance')
axes[1].set_xlabel('Business Area')
axes[1].set_ylabel('Actual vs Forecast Variance')
axes[1].ticklabel_format(style='plain', axis='y')
plt.setp(axes[1].get_xticklabels(), rotation=45, ha='right')
plt.tight_layout()
plt.show()

print("\n--- Country Variance Plots ---")

# Plotting Actual vs Plan Variance for Country
fig, axes = plt.subplots(1, 2, figsize=(18, 7))
sns.barplot(x=top5_country_plan_high.index, y='Actual vs Plan Variance', data=top5_country_plan_high, ax=axes[0], palette='viridis', hue=top5_country_plan_high.index, legend=False)
axes[0].set_title('Top 5 Countries: Actual vs Plan Variance')
axes[0].set_xlabel('Country')
axes[0].set_ylabel('Actual vs Plan Variance')
axes[0].ticklabel_format(style='plain', axis='y')
plt.setp(axes[0].get_xticklabels(), rotation=45, ha='right')

sns.barplot(x=top5_country_plan_low.index, y='Actual vs Plan Variance', data=top5_country_plan_low, ax=axes[1], palette='plasma', hue=top5_country_plan_low.index, legend=False)
axes[1].set_title('Bottom 5 Countries: Actual vs Plan Variance')
axes[1].set_xlabel('Country')
axes[1].set_ylabel('Actual vs Plan Variance')
axes[1].ticklabel_format(style='plain', axis='y')
plt.setp(axes[1].get_xticklabels(), rotation=45, ha='right')
plt.tight_layout()
plt.show()

# Plotting Actual vs Forecast Variance for Country
fig, axes = plt.subplots(1, 2, figsize=(18, 7))
sns.barplot(x=top5_country_forecast_high.index, y='Actual vs Forecast Variance', data=top5_country_forecast_high, ax=axes[0], palette='viridis', hue=top5_country_forecast_high.index, legend=False)
axes[0].set_title('Top 5 Countries: Actual vs Forecast Variance')
axes[0].set_xlabel('Country')
axes[0].set_ylabel('Actual vs Forecast Variance')
axes[0].ticklabel_format(style='plain', axis='y')
plt.setp(axes[0].get_xticklabels(), rotation=45, ha='right')

sns.barplot(x=top5_country_forecast_low.index, y='Actual vs Forecast Variance', data=top5_country_forecast_low, ax=axes[1], palette='plasma', hue=top5_country_forecast_low.index, legend=False)
axes[1].set_title('Bottom 5 Countries: Actual vs Forecast Variance')
axes[1].set_xlabel('Country')
axes[1].set_ylabel('Actual vs Forecast Variance')
axes[1].ticklabel_format(style='plain', axis='y')
plt.setp(axes[1].get_xticklabels(), rotation=45, ha='right')
plt.tight_layout()
plt.show()

print("\n--- Cost Element Name Variance Plots ---")

# Plotting Actual vs Plan Variance for Cost element name
fig, axes = plt.subplots(1, 2, figsize=(20, 7))
sns.barplot(x=top5_cost_plan_high.index, y='Actual vs Plan Variance', data=top5_cost_plan_high, ax=axes[0], palette='viridis', hue=top5_cost_plan_high.index, legend=False)
axes[0].set_title('Top 5 Cost Elements: Actual vs Plan Variance')
axes[0].set_xlabel('Cost element name')
axes[0].set_ylabel('Actual vs Plan Variance')
axes[0].ticklabel_format(style='plain', axis='y')
plt.setp(axes[0].get_xticklabels(), rotation=45, ha='right')

sns.barplot(x=top5_cost_plan_low.index, y='Actual vs Plan Variance', data=top5_cost_plan_low, ax=axes[1], palette='plasma', hue=top5_cost_plan_low.index, legend=False)
axes[1].set_title('Bottom 5 Cost Elements: Actual vs Plan Variance')
axes[1].set_xlabel('Cost element name')
axes[1].set_ylabel('Actual vs Plan Variance')
axes[1].ticklabel_format(style='plain', axis='y')
plt.setp(axes[1].get_xticklabels(), rotation=45, ha='right')
plt.tight_layout()
plt.show()

# Plotting Actual vs Forecast Variance for Cost element name
fig, axes = plt.subplots(1, 2, figsize=(20, 7))
sns.barplot(x=top5_cost_forecast_high.index, y='Actual vs Forecast Variance', data=top5_cost_forecast_high, ax=axes[0], palette='viridis', hue=top5_cost_forecast_high.index, legend=False)
axes[0].set_title('Top 5 Cost Elements: Actual vs Forecast Variance')
axes[0].set_xlabel('Cost element name')
axes[0].set_ylabel('Actual vs Forecast Variance')
axes[0].ticklabel_format(style='plain', axis='y')
plt.setp(axes[0].get_xticklabels(), rotation=45, ha='right')

sns.barplot(x=top5_cost_forecast_low.index, y='Actual vs Forecast Variance', data=top5_cost_forecast_low, ax=axes[1], palette='plasma', hue=top5_cost_forecast_low.index, legend=False)
axes[1].set_title('Bottom 5 Cost Elements: Actual vs Forecast Variance')
axes[1].set_xlabel('Cost element name')
axes[1].set_ylabel('Actual vs Forecast Variance')
axes[1].ticklabel_format(style='plain', axis='y')
plt.setp(axes[1].get_xticklabels(), rotation=45, ha='right')
plt.tight_layout()
plt.show()

print("\n--- IT Area Variance Plots ---")

# Plotting Actual vs Plan Variance for IT Area
fig, axes = plt.subplots(1, 2, figsize=(18, 7))
sns.barplot(x=top5_it_plan_high.index, y='Actual vs Plan Variance', data=top5_it_plan_high, ax=axes[0], palette='viridis', hue=top5_it_plan_high.index, legend=False)
axes[0].set_title('Top 5 IT Areas: Actual vs Plan Variance')
axes[0].set_xlabel('IT Area')
axes[0].set_ylabel('Actual vs Plan Variance')
axes[0].ticklabel_format(style='plain', axis='y')
plt.setp(axes[0].get_xticklabels(), rotation=45, ha='right')

sns.barplot(x=top5_it_plan_low.index, y='Actual vs Plan Variance', data=top5_it_plan_low, ax=axes[1], palette='plasma', hue=top5_it_plan_low.index, legend=False)
axes[1].set_title('Bottom 5 IT Areas: Actual vs Plan Variance')
axes[1].set_xlabel('IT Area')
axes[1].set_ylabel('Actual vs Plan Variance')
axes[1].ticklabel_format(style='plain', axis='y')
plt.setp(axes[1].get_xticklabels(), rotation=45, ha='right')
plt.tight_layout()
plt.show()

# Plotting Actual vs Forecast Variance for IT Area
fig, axes = plt.subplots(1, 2, figsize=(18, 7))
sns.barplot(x=top5_it_forecast_high.index, y='Actual vs Forecast Variance', data=top5_it_forecast_high, ax=axes[0], palette='viridis', hue=top5_it_forecast_high.index, legend=False)
axes[0].set_title('Top 5 IT Areas: Actual vs Forecast Variance')
axes[0].set_xlabel('IT Area')
axes[0].set_ylabel('Actual vs Forecast Variance')
axes[0].ticklabel_format(style='plain', axis='y')
plt.setp(axes[0].get_xticklabels(), rotation=45, ha='right')

sns.barplot(x=top5_it_forecast_low.index, y='Actual vs Forecast Variance', data=top5_it_forecast_low, ax=axes[1], palette='plasma', hue=top5_it_forecast_low.index, legend=False)
axes[1].set_title('Bottom 5 IT Areas: Actual vs Forecast Variance')
axes[1].set_xlabel('IT Area')
axes[1].set_ylabel('Actual vs Forecast Variance')
axes[1].ticklabel_format(style='plain', axis='y')
plt.setp(axes[1].get_xticklabels(), rotation=45, ha='right')
plt.tight_layout()
plt.show()

"""## Final Task

### Subtask:
Summarize the key findings from the variance analysis, highlighting the main areas of discrepancy and suggesting potential next steps for better IT financial control.

## Summary:

### Q&A
The analysis aimed to summarize key findings from variance analysis, highlighting main areas of discrepancy, and suggesting potential next steps for better IT financial control.

### Data Analysis Key Findings
*   **Data Preparation**: The dataset was successfully prepared by converting the 'Date' column to datetime objects, extracting the 'Month', and filling all missing ('NaN') values in the 'Actual', 'Forecast', and 'Plan' columns with 0.
*   **Variance Calculation**: New columns, 'Actual vs Plan Variance' and 'Actual vs Forecast Variance', were successfully calculated by subtracting 'Plan' from 'Actual' and 'Forecast' from 'Actual', respectively.
*   **Monthly Discrepancies**: Significant negative variances against both plan and forecast were observed in the latter part of the year, particularly in Months 9, 10, 11, and 12, indicating consistent underperformance or overspending during these periods.
*   **Business Area Underperformance**: The 'Infrastructure' business area consistently exhibited the most substantial negative variances against both plan and forecast, suggesting this area frequently exceeds its budget.
*   **Geographic Variance**: 'USA' showed the largest negative variances for both Actual vs Plan and Actual vs Forecast, indicating a significant overspend or underestimation of costs within this region.
*   **Key Cost Drivers of Variance**: 'Regular Salaries And Wages', 'Professional Services', and 'Software' were identified as major contributors to large negative variances against both plan and forecast. Conversely, 'Telephone' and 'Payroll Taxes - Salaries' showed some of the highest positive 'Actual vs Plan Variance'.
*   **IT Area Discrepancies**: The 'Functional' IT Area, followed by 'BU Support' and 'Infrastructure', consistently presented the largest negative variances, highlighting these areas as primary sources of budget discrepancies.

### Insights or Next Steps
*   **Investigate Consistent Underperformers**: Conduct a deep dive into 'Infrastructure' and 'Functional' IT areas, 'USA' operations, and cost elements like 'Regular Salaries And Wages', 'Professional Services', and 'Software' to understand the root causes of their consistent negative variances. This should involve reviewing budgeting assumptions, project scopes, and operational efficiencies.
*   **Refine Planning and Forecasting Accuracy**: Given the recurring negative variances in specific months and dimensions, review and improve the accuracy of the planning and forecasting processes. This could include incorporating more historical data trends, adjusting for seasonal factors, and increasing communication between financial planning and operational teams to set more realistic targets.

# Task
Present the comprehensive variance analysis of the 'IT Expenditure dataset.xlsx' including key findings, insights, and actionable next steps.

## Fix sns.barplot FutureWarning

### Subtask:
Modify the bar chart generation for 'Actual vs Plan Variance' by country to include `hue` and `legend=False` to resolve the `FutureWarning`.

## Summary:

### Data Analysis Key Findings
No data analysis key findings are available from the provided process step, as it focuses on a technical fix rather than data analysis.

### Insights or Next Steps
*   Proceed with the comprehensive variance analysis of the 'IT Expenditure dataset.xlsx' now that the `FutureWarning` in bar chart generation has been addressed.
"""